<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/activityservice/src/main/java/com/fitness/activityservice/config/WebClientConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/activityservice/src/main/java/com/fitness/activityservice/config/WebClientConfig.java" />
              <option name="originalContent" value="package com.fitness.activityservice.config;&#10;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.cloud.client.loadbalancer.LoadBalanced;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.web.reactive.function.client.WebClient;&#10;&#10;@Configuration&#10;public class WebClientConfig {&#10;&#10;    @Bean&#10;    @LoadBalanced&#10;    public WebClient.Builder webClientBuilder() {&#10;        return WebClient.builder();&#10;    }&#10;&#10;    @Bean&#10;    public WebClient userServiceWebClient(@Value(&quot;${user.service.base-url:http://localhost:8081}&quot;) String userServiceBaseUrl) {&#10;        // Use WebClient.create(String) to avoid LoadBalancer behavior for resolved hostnames&#10;        return WebClient.create(userServiceBaseUrl);&#10;    }&#10;&#10;//    @Bean&#10;//public WebClient userServiceWebClient(WebClient.Builder webClientBuilder) {&#10;//    return webClientBuilder&#10;//            .baseUrl(&quot;http://USER-SERVICE&quot;)&#10;//            .build();&#10;//}&#10;}" />
              <option name="updatedContent" value="package com.fitness.activityservice.config;&#10;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.cloud.client.loadbalancer.LoadBalanced;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.web.reactive.function.client.WebClient;&#10;&#10;@Configuration&#10;public class WebClientConfig {&#10;&#10;    @Bean&#10;    @LoadBalanced&#10;    public WebClient.Builder webClientBuilder() {&#10;        return WebClient.builder();&#10;    }&#10;&#10;    @Bean&#10;    public WebClient userServiceWebClient(@Value(&quot;${user.service.base-url:http://localhost:8081}&quot;) String userServiceBaseUrl) {&#10;        // Use WebClient.create(String) to avoid LoadBalancer behavior for resolved hostnames&#10;        return WebClient.create(userServiceBaseUrl);&#10;    }&#10;&#10;//    @Bean&#10;//public WebClient userServiceWebClient(WebClient.Builder webClientBuilder) {&#10;//    return webClientBuilder&#10;//            .baseUrl(&quot;http://USER-SERVICE&quot;)&#10;//            .build();&#10;//}&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/activityservice/src/main/java/com/fitness/activityservice/service/UserValidationService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/activityservice/src/main/java/com/fitness/activityservice/service/UserValidationService.java" />
              <option name="originalContent" value="package com.fitness.activityservice.service;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.web.reactive.function.client.WebClient;&#10;import org.springframework.web.reactive.function.client.WebClientResponseException;&#10;&#10;@Service&#10;@Slf4j&#10;@RequiredArgsConstructor&#10;public class UserValidationService {&#10;    private final WebClient userServiceWebClient;&#10;&#10;    public boolean validateUser(String userId) {&#10;        log.info(&quot;Calling User Validation API for userId: {}&quot;, userId);&#10;        try{&#10;            Boolean result = userServiceWebClient.get()&#10;                    .uri(uriBuilder -&gt; uriBuilder.path(&quot;/api/users/{userId}/validate&quot;).build(userId))&#10;                    .retrieve()&#10;                    .bodyToMono(Boolean.class)&#10;                    .block();&#10;            return Boolean.TRUE.equals(result);&#10;        } catch (WebClientResponseException e) {&#10;            if (e.getStatusCode() == HttpStatus.NOT_FOUND)&#10;                throw new RuntimeException(&quot;User Not Found: &quot; + userId);&#10;            else if (e.getStatusCode() == HttpStatus.BAD_REQUEST)&#10;                throw new RuntimeException(&quot;Invalid Request: &quot; + userId);&#10;        }&#10;        return false;&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.fitness.activityservice.service;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.web.reactive.function.client.WebClient;&#10;import org.springframework.web.reactive.function.client.WebClientResponseException;&#10;&#10;@Service&#10;@Slf4j&#10;@RequiredArgsConstructor&#10;public class UserValidationService {&#10;    private final WebClient userServiceWebClient;&#10;&#10;    public boolean validateUser(String userId) {&#10;        log.info(&quot;Calling User Validation API for userId: {}&quot;, userId);&#10;        try{&#10;            Boolean result = userServiceWebClient.get()&#10;                    .uri(uriBuilder -&gt; uriBuilder.path(&quot;/api/users/{userId}/validate&quot;).build(userId))&#10;                    .retrieve()&#10;                    .bodyToMono(Boolean.class)&#10;                    .block();&#10;            return Boolean.TRUE.equals(result);&#10;        } catch (WebClientResponseException e) {&#10;            if (e.getStatusCode() == HttpStatus.NOT_FOUND)&#10;                throw new RuntimeException(&quot;User Not Found: &quot; + userId);&#10;            else if (e.getStatusCode() == HttpStatus.BAD_REQUEST)&#10;                throw new RuntimeException(&quot;Invalid Request: &quot; + userId);&#10;        }&#10;        return false;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/configserver/src/main/resources/config/activity-service.yml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/configserver/src/main/resources/config/activity-service.yml" />
              <option name="originalContent" value="spring:&#10;  data:&#10;    mongodb:&#10;      # Use environment variables for credentials. Let the driver negotiate the auth mechanism&#10;      # (remove authMechanism to avoid forcing SCRAM-SHA-1 which can fail if the user uses SCRAM-SHA-256).&#10;      # Default MONGO_HOST changed to 192.168.1.106 to match common local Docker host used in this repo&#10;      uri: mongodb://${MONGO_USER:root}:${MONGO_PASS:example}@${MONGO_HOST:192.168.1.106}:${MONGO_PORT:27017}/aiactivityfitness?authSource=admin&#10;      # Alternative (if your Mongo user requires SCRAM-SHA-256):&#10;      # uri: mongodb://${MONGO_USER:root}:${MONGO_PASS:example}@192.168.1.106:27017/aiactivityfitness?authSource=admin&amp;authMechanism=SCRAM-SHA-256&#10;      database: aiactivityfitness&#10;  kafka:&#10;    bootstrap-servers: ${KAFKA_HOST:localhost}:${SERVER_PORT:9092}&#10;    producer:&#10;      key-serializer: org.apache.kafka.common.serialization.StringSerializer&#10;      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer&#10;  security:&#10;    oauth2:&#10;      resourceserver:&#10;        jwt:&#10;          jwk-set-uri: http://${KEY_CLOAK_HOST:localhost}:${KEY_CLOAK_PORT:8181}/realms/fitness-app/protocol/openid-connect/certs&#10;&#10;&#10;kafka:&#10;  topic:&#10;    name: activity-events&#10;&#10;eureka:&#10;  client:&#10;    serviceUrl:&#10;      defaultZone: http://${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}/eureka/&#10;&#10;server:&#10;  port: 8082&#10;&#10;# local fallback for user validation (can be overridden with env or config server)&#10;user:&#10;  service:&#10;    base-url: http://localhost:8081&#10;" />
              <option name="updatedContent" value="spring:&#10;  data:&#10;    mongodb:&#10;      # Use environment variables for credentials. Let the driver negotiate the auth mechanism&#10;      # (remove authMechanism to avoid forcing SCRAM-SHA-1 which can fail if the user uses SCRAM-SHA-256).&#10;      # Default MONGO_HOST changed to 192.168.1.106 to match common local Docker host used in this repo&#10;      uri: mongodb://${MONGO_USER:root}:${MONGO_PASS:example}@${MONGO_HOST:192.168.1.106}:${MONGO_PORT:27017}/aiactivityfitness?authSource=admin&#10;      # Alternative (if your Mongo user requires SCRAM-SHA-256):&#10;      # uri: mongodb://${MONGO_USER:root}:${MONGO_PASS:example}@192.168.1.106:27017/aiactivityfitness?authSource=admin&amp;authMechanism=SCRAM-SHA-256&#10;      database: aiactivityfitness&#10;  kafka:&#10;    bootstrap-servers: ${KAFKA_HOST:localhost}:${SERVER_PORT:9092}&#10;    producer:&#10;      key-serializer: org.apache.kafka.common.serialization.StringSerializer&#10;      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer&#10;  security:&#10;    oauth2:&#10;      resourceserver:&#10;        jwt:&#10;          jwk-set-uri: http://${KEY_CLOAK_HOST:localhost}:${KEY_CLOAK_PORT:8181}/realms/fitness-app/protocol/openid-connect/certs&#10;&#10;&#10;kafka:&#10;  topic:&#10;    name: activity-events&#10;&#10;eureka:&#10;  client:&#10;    serviceUrl:&#10;      defaultZone: http://${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}/eureka/&#10;&#10;server:&#10;  port: 8082&#10;&#10;# local fallback for user validation (can be overridden with env or config server)&#10;user:&#10;  service:&#10;    base-url: http://localhost:8081" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/userservice/src/main/java/com/fitness/userservice/repository/UserRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/userservice/src/main/java/com/fitness/userservice/repository/UserRepository.java" />
              <option name="originalContent" value="package com.fitness.userservice.repository;&#10;&#10;import com.fitness.userservice.model.User;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;@Repository&#10;public interface UserRepository extends JpaRepository&lt;User, String&gt; {&#10;    boolean existsByEmail(String email);&#10;&#10;    Boolean existsByKeycloakId(String userId);&#10;&#10;    User findByEmail(String email);&#10;}" />
              <option name="updatedContent" value="package com.fitness.userservice.repository;&#10;&#10;import com.fitness.userservice.model.User;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;@Repository&#10;public interface UserRepository extends JpaRepository&lt;User, String&gt; {&#10;    boolean existsByEmail(String email);&#10;&#10;    Boolean existsByKeycloakId(String userId);&#10;&#10;    User findByEmail(String email);&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>